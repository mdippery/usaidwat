#!/usr/bin/env ruby

require 'usaidwat'


def die(code=1)
  $stderr.puts "Usage: #{File.basename $0} <user> [<subreddit>]"
  exit code
end

die if $*.length < 1 or $*.length > 2

subreddit = $*.length == 2 ? $*.last : nil
reddit_user = USaidWat::RedditUser.new $*.first
unless subreddit
  comments = reddit_user.retrieve_comments
  exit 2 unless comments
  max_key = 1
  comments.each { |c| max_key = c.first.length if c.first.length > max_key }
  comments.each { |c| printf "%-*s  %s\n", max_key, c.first, c.last }
else
  comments = reddit_user.comments_for_subreddit subreddit
  is_first = true
  width = `tput cols`.to_i rescue 80
  comments.each do |c|
    puts '-' * width unless is_first
    puts c
    is_first = false
  end
end
