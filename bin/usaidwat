#!/usr/bin/env ruby

require 'usaidwat'
require 'usaidwat/utils'


def die(code=1, stream=STDERR)
  stream.puts "Usage: #{File.basename $0} <user> [<subreddit>]"
  exit code
end

die if ARGV.length < 1 or ARGV.length > 2

die(0, STDOUT) if ARGV.first == '--help' || ARGV.first == '-h'

if ARGV.first == '--version' or ARGV.first == '-V'
  puts "usaidwat v#{USaidWat::VERSION}"
  exit 0
end

reddit_user = USaidWat::RedditUser.new ARGV.shift
if ARGV.length == 0
  comments = reddit_user.retrieve_comments
  exit 2 unless comments
  max_key = comments.longest_subreddit.length
  comments.each { |c| printf "%-*s  %s\n", max_key, c.first, c.last }
else
  subreddit = ARGV.shift
  comments = reddit_user.comments_for_subreddit subreddit
  unless comments
    puts "No comments by #{reddit_user.username} for #{subreddit}."
    exit 0
  end
  is_first = true
  run_pager
  width = `tput cols`.to_i rescue 80
  comments.each do |c|
    puts '-' * width unless is_first
    puts c
    is_first = false
  end
end
